<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æ›¼è°·ä¹‹æ—… | Bangkok Trip</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    /* --------------------------
       Base
    -------------------------- */
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root{
      --bg1:#1a1a2e;
      --bg2:#16213e;
      --gold:#ffd700;
      --orange:#ff6b35;
      --glass: rgba(255,255,255,0.10);
      --glass2: rgba(255,255,255,0.14);
      --stroke: rgba(255,255,255,0.20);
      --stroke2: rgba(255,255,255,0.26);
      --shadow: rgba(0,0,0,0.35);
      --good:#4ade80;
      --warn:#fbbf24;
      --bad:#fb7185;
      --chip: rgba(255,255,255,0.08);
      --chip2: rgba(255,255,255,0.12);
    }

    html { scroll-behavior: smooth; }

    body {
      font-family: 'Noto Sans TC', sans-serif;
      background: linear-gradient(135deg, var(--bg1) 0%, var(--bg2) 100%);
      min-height: 100vh;
      color: #fff;
      overflow-x: hidden;
    }

    a { color: inherit; text-decoration: none; }

    /* --------------------------
       Floating Elements
    -------------------------- */
    .floating-elements {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
      overflow: hidden;
    }

    .floating-element {
      position: absolute;
      font-size: 2rem;
      opacity: 0.1;
      animation: float 20s infinite;
    }

    @keyframes float {
      0%, 100% {
        transform: translateY(100vh) rotate(0deg);
        opacity: 0;
      }
      10% { opacity: 0.1; }
      90% { opacity: 0.1; }
      100% {
        transform: translateY(-100px) rotate(360deg);
        opacity: 0;
      }
    }

    /* --------------------------
       Top Nav
    -------------------------- */
    .topbar{
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 50;
      padding: 14px 18px;
      display: flex;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
      background: linear-gradient(180deg, rgba(0,0,0,0.45), rgba(0,0,0,0.10));
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(255,255,255,0.08);
    }

    .brand{
      display: flex;
      align-items: center;
      gap: 10px;
      min-width: 220px;
    }

    .brand .logo{
      width: 38px;
      height: 38px;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--gold), var(--orange));
      display: grid;
      place-items: center;
      box-shadow: 0 10px 30px rgba(255,215,0,0.15);
      font-size: 18px;
      font-weight: 800;
      color: #1b1b2e;
    }

    .brand .titles{
      display: flex;
      flex-direction: column;
      line-height: 1.1;
    }

    .brand .titles .t1{ font-weight: 700; }
    .brand .titles .t2{ font-size: 0.85rem; opacity: 0.75; }

    .nav-actions{
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .pill{
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.14);
      cursor: pointer;
      user-select: none;
      transition: transform .2s ease, border-color .2s ease, background .2s ease;
      font-size: 0.92rem;
    }

    .pill:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,0.25); background: rgba(255,255,255,0.11); }
    .pill i{ color: var(--gold); }

    .pill.primary{
      background: linear-gradient(135deg, rgba(255,215,0,0.20), rgba(255,107,53,0.18));
      border-color: rgba(255,215,0,0.28);
    }

    .pill.primary:hover{ border-color: rgba(255,215,0,0.45); }

    .pill.active{ outline: 2px solid rgba(255,215,0,0.30); }

    .kbd{
      font-size: 0.75rem;
      opacity: 0.7;
      padding: 3px 8px;
      border-radius: 8px;
      background: rgba(0,0,0,0.25);
      border: 1px solid rgba(255,255,255,0.10);
    }

    /* --------------------------
       Hero
    -------------------------- */
    .hero {
      height: 100vh;
      background: linear-gradient(rgba(0,0,0,0.40), rgba(0,0,0,0.62)),
      url('https://images.unsplash.com/photo-1693501107615-a412a9e29ccf?auto=format&fit=crop&fm=jpg&q=80&w=3000') center/cover;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      position: relative;
      overflow: hidden;
      padding: 0 20px;
    }

    .hero::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(45deg, var(--orange), #f7c59f, #efefd0, var(--orange));
      background-size: 400% 400%;
      animation: gradientShift 15s ease infinite;
      opacity: 0.10;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .hero-inner{
      position: relative;
      max-width: 980px;
      width: 100%;
    }

    .hero h1 {
      font-size: 4rem;
      font-weight: 700;
      margin-bottom: 1rem;
      animation: fadeInDown 1s ease;
      text-shadow: 2px 2px 20px rgba(0,0,0,0.55);
      letter-spacing: 1px;
    }

    .hero h1 span { color: var(--gold); }

    .hero p {
      font-size: 1.5rem;
      opacity: 0;
      animation: fadeInUp 1s ease 0.5s forwards;
    }

    .hero-badges{
      margin-top: 18px;
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
      opacity: 0;
      animation: fadeInUp 1s ease 0.9s forwards;
    }

    .badge{
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,0.10);
      border: 1px solid rgba(255,255,255,0.18);
      backdrop-filter: blur(10px);
      font-size: 0.95rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
    }

    .badge i{ color: var(--gold); }

    .scroll-indicator {
      position: absolute;
      bottom: 30px;
      animation: bounce 2s infinite;
      cursor: pointer;
    }

    .scroll-indicator i {
      font-size: 2rem;
      color: var(--gold);
    }

    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
      40% { transform: translateY(-20px); }
      60% { transform: translateY(-10px); }
    }

    @keyframes fadeInDown {
      from { opacity: 0; transform: translateY(-50px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(50px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* --------------------------
       Summary / Controls Section
    -------------------------- */
    .summary-section{
      padding: 80px 20px 30px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .section-title {
      text-align: center;
      font-size: 2.5rem;
      margin-bottom: 22px;
      position: relative;
    }

    .section-title::after {
      content: '';
      display: block;
      width: 100px;
      height: 4px;
      background: linear-gradient(90deg, var(--gold), var(--orange));
      margin: 15px auto 0;
      border-radius: 2px;
    }

    .subtitle{
      text-align: center;
      opacity: 0.75;
      max-width: 820px;
      margin: 0 auto 28px;
      line-height: 1.6;
    }

    .summary-grid{
      display: grid;
      grid-template-columns: 1.2fr 1fr;
      gap: 16px;
      align-items: stretch;
    }

    .panel{
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.14);
      border-radius: 22px;
      padding: 18px;
      backdrop-filter: blur(10px);
      box-shadow: 0 18px 50px rgba(0,0,0,0.25);
    }

    .panel h3{
      font-size: 1.1rem;
      font-weight: 700;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .panel h3 i{ color: var(--gold); }

    .chips{
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 8px;
    }

    .chip{
      background: var(--chip);
      border: 1px solid rgba(255,255,255,0.14);
      border-radius: 999px;
      padding: 9px 12px;
      font-size: 0.92rem;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      transition: transform .2s ease, background .2s ease, border-color .2s ease;
      user-select: none;
    }

    .chip:hover{ transform: translateY(-1px); background: var(--chip2); border-color: rgba(255,255,255,0.25); }
    .chip.active{ outline: 2px solid rgba(255,215,0,0.28); }

    .chip i{ color: var(--gold); }

    .stats{
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-top: 10px;
    }

    .stat{
      background: rgba(0,0,0,0.18);
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: 18px;
      padding: 14px;
      text-align: center;
    }

    .stat .num{ font-size: 1.6rem; font-weight: 800; color: var(--gold); }
    .stat .lbl{ opacity: 0.75; margin-top: 4px; font-size: 0.92rem; }

    .mini-row{
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    .input{
      flex: 1;
      min-width: 240px;
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 14px;
      border-radius: 16px;
      background: rgba(0,0,0,0.18);
      border: 1px solid rgba(255,255,255,0.10);
    }

    .input i{ color: var(--gold); }

    .input input{
      width: 100%;
      border: none;
      outline: none;
      background: transparent;
      color: #fff;
      font-size: 0.98rem;
    }

    .toggle{
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 12px 14px;
      border-radius: 16px;
      background: rgba(0,0,0,0.18);
      border: 1px solid rgba(255,255,255,0.10);
      cursor: pointer;
      user-select: none;
      transition: transform .2s ease, border-color .2s ease;
    }

    .toggle:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,0.18); }

    .switch{
      width: 44px;
      height: 24px;
      border-radius: 999px;
      background: rgba(255,255,255,0.16);
      position: relative;
      border: 1px solid rgba(255,255,255,0.10);
    }

    .switch::after{
      content:'';
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--gold), var(--orange));
      position: absolute;
      top: 50%;
      left: 3px;
      transform: translateY(-50%);
      transition: left .22s ease;
    }

    .toggle[data-on="true"] .switch::after{ left: 23px; }

    /* --------------------------
       Timeline
    -------------------------- */
    .timeline-section {
      padding: 30px 20px 80px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .timeline {
      position: relative;
      padding: 20px 0;
    }

    .timeline::before {
      content: '';
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      width: 4px;
      height: 100%;
      background: linear-gradient(180deg, var(--gold), var(--orange), var(--gold));
      border-radius: 2px;
    }

    .day-card {
      display: flex;
      justify-content: flex-end;
      padding: 20px 40px;
      position: relative;
      width: 50%;
      opacity: 0;
      transform: translateX(-100px);
      transition: all 0.6s ease;
    }

    .day-card.visible { opacity: 1; transform: translateX(0); }

    .day-card:nth-child(even) {
      justify-content: flex-start;
      margin-left: 50%;
      transform: translateX(100px);
    }

    .day-card:nth-child(even).visible { transform: translateX(0); }

    .day-card::before {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      background: var(--gold);
      border-radius: 50%;
      right: -10px;
      top: 35px;
      box-shadow: 0 0 20px var(--gold);
      animation: pulse 2s infinite;
    }

    .day-card:nth-child(even)::before { left: -10px; right: auto; }

    @keyframes pulse {
      0%, 100% { box-shadow: 0 0 20px var(--gold); }
      50% { box-shadow: 0 0 40px var(--gold), 0 0 60px var(--orange); }
    }

    .card-content {
      background: var(--glass);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      max-width: 480px;
      border: 1px solid var(--stroke);
      transition: all 0.25s ease;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .card-content::after{
      content:'';
      position:absolute;
      inset:-30px;
      background: radial-gradient(circle at 20% 20%, rgba(255,215,0,0.18), transparent 45%),
                  radial-gradient(circle at 85% 40%, rgba(255,107,53,0.16), transparent 45%);
      opacity: 0.0;
      transition: opacity .25s ease;
      pointer-events:none;
    }

    .card-content:hover { transform: translateY(-10px) scale(1.02); box-shadow: 0 22px 50px rgba(255,215,0,0.12); border-color: rgba(255,215,0,0.45); }
    .card-content:hover::after{ opacity: 1; }

    .day-header { display: flex; align-items: center; gap: 15px; margin-bottom: 16px; }

    .day-number {
      background: linear-gradient(135deg, var(--gold), var(--orange));
      width: 60px;
      height: 60px;
      border-radius: 15px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: #1b1b2e;
      box-shadow: 0 14px 35px rgba(255,215,0,0.12);
    }

    .day-number span:first-child { font-size: 0.7rem; opacity: 0.85; letter-spacing: 1px; }
    .day-number span:last-child { font-size: 1.5rem; }

    .day-title { font-size: 1.25rem; font-weight: 700; }
    .day-date { font-size: 0.92rem; opacity: 0.72; margin-top: 2px; }

    .meta-row{
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .tag{
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,0.18);
      border: 1px solid rgba(255,255,255,0.12);
      font-size: 0.88rem;
      opacity: 0.95;
    }

    .tag i{ color: var(--gold); }

    .activities { list-style: none; margin-top: 16px; }

    .activities li {
      padding: 12px 0;
      border-bottom: 1px solid rgba(255,255,255,0.10);
      display: flex;
      align-items: center;
      gap: 12px;
      transition: all 0.25s ease;
    }

    .activities li:last-child { border-bottom: none; }

    .activities li:hover { padding-left: 10px; color: var(--gold); }

    .activities li i { color: var(--gold); width: 25px; }

    .activity-time { font-size: 0.85rem; color: var(--orange); margin-left: auto; font-weight: 600; }

    .note{
      margin-top: 14px;
      padding: 12px 14px;
      border-radius: 16px;
      background: rgba(0,0,0,0.16);
      border: 1px dashed rgba(255,255,255,0.16);
      font-size: 0.92rem;
      opacity: 0.9;
      line-height: 1.55;
    }

    .note b{ color: var(--gold); }

    .mini-actions{
      margin-top: 16px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .mini-btn{
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,0.09);
      border: 1px solid rgba(255,255,255,0.14);
      cursor: pointer;
      transition: transform .2s ease, border-color .2s ease, background .2s ease;
      font-size: 0.92rem;
      user-select: none;
    }

    .mini-btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,0.12); border-color: rgba(255,215,0,0.35); }
    .mini-btn i{ color: var(--gold); }

    /* --------------------------
       Modal
    -------------------------- */
    .modal{
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
      z-index: 100;
      background: rgba(0,0,0,0.55);
      backdrop-filter: blur(8px);
    }

    .modal.open{ display: flex; }

    .modal-card{
      width: min(920px, 100%);
      border-radius: 24px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.10);
      box-shadow: 0 30px 90px rgba(0,0,0,0.45);
      overflow: hidden;
      position: relative;
      transform: translateY(12px);
      opacity: 0;
      animation: modalIn .18s ease forwards;
    }

    @keyframes modalIn{
      to{ transform: translateY(0); opacity: 1; }
    }

    .modal-top{
      display: grid;
      grid-template-columns: 1.2fr 0.8fr;
      gap: 0;
    }

    .modal-hero{
      padding: 18px 18px 10px;
      background: radial-gradient(circle at 20% 20%, rgba(255,215,0,0.16), transparent 55%),
                  radial-gradient(circle at 80% 35%, rgba(255,107,53,0.14), transparent 55%);
    }

    .modal-hero h4{
      font-size: 1.35rem;
      font-weight: 800;
      margin-top: 4px;
    }

    .modal-hero .small{
      opacity: 0.75;
      margin-top: 6px;
      line-height: 1.5;
    }

    .modal-kv{
      padding: 18px;
      background: rgba(0,0,0,0.20);
      border-left: 1px solid rgba(255,255,255,0.10);
    }

    .kv{
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }

    .kv .item{
      padding: 12px 12px;
      border-radius: 16px;
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.12);
    }

    .kv .item .k{ opacity: 0.75; font-size: 0.86rem; }
    .kv .item .v{ margin-top: 4px; font-weight: 700; }

    .modal-body{
      padding: 18px;
    }

    .modal-body h5{
      font-size: 1.05rem;
      font-weight: 800;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .modal-body h5 i{ color: var(--gold); }

    .modal-body ul{ list-style: none; }

    .modal-body li{
      padding: 12px 10px;
      display: flex;
      align-items: center;
      gap: 10px;
      border-bottom: 1px solid rgba(255,255,255,0.10);
    }

    .modal-body li:last-child{ border-bottom: none; }

    .modal-body .t{ opacity: 0.95; }
    .modal-body .tm{ margin-left: auto; color: var(--orange); font-weight: 700; font-size: 0.9rem; }

    .modal-actions{
      padding: 14px 18px 18px;
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      flex-wrap: wrap;
      border-top: 1px solid rgba(255,255,255,0.10);
    }

    .btn{
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 14px;
      border-radius: 14px;
      background: rgba(255,255,255,0.09);
      border: 1px solid rgba(255,255,255,0.14);
      cursor: pointer;
      transition: transform .2s ease, border-color .2s ease, background .2s ease;
      user-select: none;
      font-size: 0.95rem;
    }

    .btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,0.12); border-color: rgba(255,215,0,0.35); }
    .btn.primary{ background: linear-gradient(135deg, rgba(255,215,0,0.18), rgba(255,107,53,0.16)); border-color: rgba(255,215,0,0.35); }
    .btn.primary:hover{ border-color: rgba(255,215,0,0.52); }

    .close-x{
      position: absolute;
      top: 12px;
      right: 12px;
      width: 42px;
      height: 42px;
      border-radius: 14px;
      display: grid;
      place-items: center;
      background: rgba(0,0,0,0.22);
      border: 1px solid rgba(255,255,255,0.12);
      cursor: pointer;
      transition: transform .2s ease, border-color .2s ease;
    }

    .close-x:hover{ transform: translateY(-1px); border-color: rgba(255,215,0,0.35); }

    /* Toast */
    .toast{
      position: fixed;
      left: 50%;
      bottom: 26px;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.58);
      border: 1px solid rgba(255,255,255,0.14);
      backdrop-filter: blur(10px);
      padding: 12px 14px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      gap: 10px;
      opacity: 0;
      pointer-events: none;
      transition: opacity .22s ease, transform .22s ease;
      z-index: 120;
      max-width: min(92vw, 860px);
    }

    .toast.show{ opacity: 1; transform: translateX(-50%) translateY(-6px); }
    .toast i{ color: var(--gold); }
    .toast span{ opacity: 0.92; font-size: 0.95rem; }


    /* Modal photo strip */
    .photo-strip{
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-bottom: 14px;
    }
    .photo{
      position: relative;
      border-radius: 18px;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.18);
      min-height: 110px;
    }
    .photo img{
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      transform: scale(1.02);
      filter: saturate(1.05);
    }
    .photo .cap{
      position: absolute;
      left: 10px;
      right: 10px;
      bottom: 10px;
      font-size: 0.86rem;
      font-weight: 700;
      text-shadow: 0 6px 20px rgba(0,0,0,0.6);
      background: linear-gradient(180deg, rgba(0,0,0,0.00), rgba(0,0,0,0.50));
      padding: 18px 10px 8px;
      border-radius: 14px;
      opacity: 0.95;
    }
    @media (max-width: 768px){
      .photo-strip{ grid-template-columns: 1fr; }
      .photo{ min-height: 150px; }
    }


    /* --------------------------
       Footer
    -------------------------- */
    .footer {
      text-align: center;
      padding: 40px;
      background: rgba(0,0,0,0.28);
      margin-top: 40px;
      border-top: 1px solid rgba(255,255,255,0.08);
    }

    .footer p { opacity: 0.7; }

    /* --------------------------
       Responsive
    -------------------------- */
    @media (max-width: 980px){
      .summary-grid{ grid-template-columns: 1fr; }
      .modal-top{ grid-template-columns: 1fr; }
      .modal-kv{ border-left: none; border-top: 1px solid rgba(255,255,255,0.10); }
    }

    @media (max-width: 768px) {
      .hero h1 { font-size: 2.5rem; }

      .timeline::before { left: 20px; }

      .day-card,
      .day-card:nth-child(even) {
        width: 100%;
        margin-left: 0;
        padding-left: 60px;
        padding-right: 20px;
        justify-content: flex-start;
      }

      .day-card::before,
      .day-card:nth-child(even)::before {
        left: 10px;
        right: auto;
      }

      .day-card,
      .day-card:nth-child(even) { transform: translateX(50px); }

      .day-card.visible,
      .day-card:nth-child(even).visible { transform: translateX(0); }

      .topbar{ padding: 12px 12px; }
      .brand{ min-width: 160px; }
      .brand .titles .t2{ display:none; }
      .pill .kbd{ display:none; }
      .stats{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <!-- Floating Background Elements -->
  <div class="floating-elements">
    <div class="floating-element" style="left: 10%; animation-delay: 0s;">ğŸ›•</div>
    <div class="floating-element" style="left: 20%; animation-delay: 3s;">ğŸ˜</div>
    <div class="floating-element" style="left: 35%; animation-delay: 6s;">ğŸœ</div>
    <div class="floating-element" style="left: 50%; animation-delay: 9s;">ğŸŒº</div>
    <div class="floating-element" style="left: 65%; animation-delay: 12s;">âœˆï¸</div>
    <div class="floating-element" style="left: 80%; animation-delay: 15s;">ğŸ›¶</div>
    <div class="floating-element" style="left: 90%; animation-delay: 18s;">ğŸ¯</div>
  </div>

  <!-- Topbar -->
  <header class="topbar">
    <div class="brand">
      <div class="logo">BK</div>
      <div class="titles">
        <div class="t1">æ›¼è°·è¦ªå­è¡Œç¨‹</div>
        <div class="t2">äº’å‹•æ™‚é–“è»¸ï½œç¯©é¸ï½œæ”¶è—ï½œåŒ¯å‡º</div>
      </div>
    </div>

    <div class="nav-actions">
      <div class="pill" id="btnToday" title="è·³åˆ°ä»Šå¤©/ä¸‹ä¸€å€‹è¡Œç¨‹ (T)">
        <i class="fa-solid fa-location-crosshairs"></i>
        <span>è·³åˆ°ä¸‹ä¸€å€‹</span>
        <span class="kbd">T</span>
      </div>

      <div class="pill" id="btnAll" title="é¡¯ç¤ºå…¨éƒ¨å¤©æ•¸ (A)">
        <i class="fa-solid fa-layer-group"></i>
        <span>å…¨éƒ¨</span>
        <span class="kbd">A</span>
      </div>

      <div class="pill" id="btnFav" title="åªçœ‹æ”¶è— (F)">
        <i class="fa-solid fa-heart"></i>
        <span>æ”¶è—</span>
        <span class="kbd">F</span>
      </div>

      <div class="pill primary" id="btnExport" title="åŒ¯å‡ºè¡Œç¨‹ (E)">
        <i class="fa-solid fa-file-arrow-down"></i>
        <span>åŒ¯å‡º</span>
        <span class="kbd">E</span>
      </div>
    </div>
  </header>

  <!-- Hero Section -->
  <section class="hero" id="top">
    <div class="hero-inner">
      <h1>ğŸ‡¹ğŸ‡­ <span>æ›¼è°·</span>ä¹‹æ—…</h1>
      <p>æ¢ç´¢å¾®ç¬‘ä¹‹åœ‹çš„ç²¾å½©æ—…ç¨‹ï¼ˆå«äº’å‹•æ™‚é–“è»¸èˆ‡è¡Œç¨‹å°å·¥å…·ï¼‰</p>

      <div class="hero-badges" id="heroBadges">
        <div class="badge"><i class="fa-solid fa-calendar-days"></i><span id="badgeDays">6 å¤©</span></div>
        <div class="badge"><i class="fa-solid fa-list-check"></i><span id="badgeItems">0 å€‹è¡Œç¨‹é»</span></div>
        <div class="badge"><i class="fa-solid fa-heart"></i><span id="badgeFavs">0 å€‹æ”¶è—</span></div>
        <div class="badge"><i class="fa-solid fa-bolt"></i><span>é»å¡ç‰‡çœ‹è©³ç´°</span></div>
      </div>
    </div>

    <div class="scroll-indicator" id="scrollToSummary" title="å¾€ä¸‹">
      <i class="fas fa-chevron-down"></i>
    </div>
  </section>

  <!-- Summary / Controls Section -->
  <section class="summary-section" id="controls">
    <h2 class="section-title">è¡Œç¨‹æ§åˆ¶å°</h2>
    <p class="subtitle">
      ä½ å¯ä»¥ç”¨ <b>ä¸»é¡Œç¯©é¸</b>ï¼ˆå¯ºå»Ÿ / å¤œå¸‚ / å‹•ç‰©åœ’ / éŠæ¨‚åœ’ / å¸‚å€è¦ªå­â€¦ï¼‰ã€ç”¨<b>é—œéµå­—</b>æœå°‹ï¼Œ
      æˆ–æŠŠå–œæ­¡çš„è¡Œç¨‹é»æŒ‰ â™¥ æ”¶è—ï¼›é»å¡ç‰‡å¯å±•é–‹æ›´è©³ç´°è³‡è¨Šï¼Œä¸¦æ”¯æ´åŒ¯å‡º TXTã€‚
    </p>

    <div class="summary-grid">
      <div class="panel">
        <h3><i class="fa-solid fa-filter"></i>ä¸»é¡Œç¯©é¸</h3>
        <div class="chips" id="chipRow"></div>

        <div class="mini-row">
          <div class="input">
            <i class="fa-solid fa-magnifying-glass"></i>
            <input id="searchInput" type="text" placeholder="æœå°‹ï¼šä¾‹å¦‚ å¤œå¸‚ / Safari / ç‰ä½›å¯º / æŒ‰æ‘©..." />
          </div>

          <div class="toggle" id="toggleCompact" data-on="false" title="ç²¾ç°¡æ¨¡å¼ï¼šåªé¡¯ç¤ºå‰ä¸‰å€‹è¡Œç¨‹é»">
            <div class="switch"></div>
            <div>
              <div style="font-weight:800;">ç²¾ç°¡æ¨¡å¼</div>
              <div style="opacity:.72; font-size:.86rem;">åªé¡¯ç¤ºå‰ä¸‰é …</div>
            </div>
          </div>
        </div>

        <div class="note" style="margin-top:12px;">
          <b>å¿«é€Ÿéµï¼š</b>
          <span style="opacity:.9;">
            <b>A</b> å…¨éƒ¨ã€<b>F</b> æ”¶è—ã€<b>E</b> åŒ¯å‡ºã€<b>T</b> è·³åˆ°ä¸‹ä¸€å€‹ã€<b>Esc</b> é—œé–‰è¦–çª—
          </span>
        </div>
      </div>

      <div class="panel">
        <h3><i class="fa-solid fa-chart-simple"></i>çµ±è¨ˆ</h3>
        <div class="stats">
          <div class="stat"><div class="num" id="statDays">0</div><div class="lbl">å¤©æ•¸</div></div>
          <div class="stat"><div class="num" id="statItems">0</div><div class="lbl">è¡Œç¨‹é»</div></div>
          <div class="stat"><div class="num" id="statFavs">0</div><div class="lbl">æ”¶è—</div></div>
        </div>

        <div class="note">
          <b>å°æé†’ï¼š</b>ç›®å‰æ™‚é–“èˆ‡ã€Œä¸‹ä¸€å€‹è¡Œç¨‹ã€æ˜¯ä»¥ä½ ç€è¦½å™¨æ‰€åœ¨æ™‚å€åˆ¤æ–·ï¼›
          è‹¥æƒ³æ”¹æˆæ›¼è°·æ™‚é–“ï¼ˆUTC+7ï¼‰ï¼Œå¯åœ¨ JS ä¸­æŠŠ <code>TIMEZONE_OFFSET_MIN</code> æ”¹ç‚º 420ã€‚
        </div>

        <div class="mini-actions">
          <div class="mini-btn" id="btnClearFilters"><i class="fa-solid fa-eraser"></i>æ¸…é™¤ç¯©é¸</div>
          <div class="mini-btn" id="btnClearFavs"><i class="fa-solid fa-heart-crack"></i>æ¸…ç©ºæ”¶è—</div>
          <div class="mini-btn" id="btnScrollTop"><i class="fa-solid fa-arrow-up"></i>å›åˆ°é ‚ç«¯</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Timeline Section -->
  <section class="timeline-section" id="timeline">
    <h2 class="section-title">è¡Œç¨‹æ™‚é–“è»¸</h2>
    <div class="timeline" id="timelineRoot"></div>
  </section>

  <!-- Footer -->
  <footer class="footer">
    <p>ğŸŒ æ¢ç´¢ä¸–ç•Œï¼Œç™¼ç¾ç²¾å½© | Bangkok Trip</p>
  </footer>

  <!-- Modal -->
  <div class="modal" id="modal">
    <div class="modal-card" role="dialog" aria-modal="true" aria-label="è¡Œç¨‹è©³ç´°è³‡è¨Š">
      <div class="close-x" id="modalClose" title="é—œé–‰ (Esc)"><i class="fa-solid fa-xmark"></i></div>

      <div class="modal-top">
        <div class="modal-hero">
          <div style="display:flex; align-items:center; gap:10px;">
            <div class="tag" id="modalDayTag"><i class="fa-solid fa-calendar"></i><span>DAY</span></div>
            <div class="tag" id="modalThemeTag"><i class="fa-solid fa-tags"></i><span>ä¸»é¡Œ</span></div>
            <div class="tag" id="modalFavTag" style="display:none;"><i class="fa-solid fa-heart"></i><span>å·²æ”¶è—</span></div>
          </div>
          <h4 id="modalTitle">æ¨™é¡Œ</h4>
          <div class="small" id="modalDate">æ—¥æœŸ</div>
          <div class="small" id="modalHint">é»ä¸‹æ–¹æŒ‰éˆ•å¯æ”¶è—ã€è¤‡è£½æ‘˜è¦ã€æˆ–åŒ¯å‡ºå…¨è¡Œç¨‹ã€‚</div>
        </div>

        <div class="modal-kv">
          <div class="kv">
            <div class="item"><div class="k">å»ºè­°å€åŸŸ</div><div class="v" id="modalArea">â€”</div></div>
            <div class="item"><div class="k">äº¤é€šå»ºè­°</div><div class="v" id="modalTransit">â€”</div></div>
            <div class="item"><div class="k">å‚™è¨»</div><div class="v" id="modalNote">â€”</div></div>
          </div>
        </div>
      </div>

      <div class="modal-body">
        <div class="photo-strip" id="modalGallery"></div>
        <h5><i class="fa-solid fa-list-check"></i>ç•¶æ—¥è¡Œç¨‹é»</h5>
        <ul id="modalList"></ul>
      </div>

      <div class="modal-actions">
        <div class="btn" id="btnCopy"><i class="fa-solid fa-copy"></i>è¤‡è£½æ‘˜è¦</div>
        <div class="btn" id="btnToggleFav"><i class="fa-solid fa-heart"></i>æ”¶è—é€™ä¸€å¤©</div>
        <div class="btn primary" id="btnExport2"><i class="fa-solid fa-file-arrow-down"></i>åŒ¯å‡ºè¡Œç¨‹</div>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast"><i class="fa-solid fa-circle-check"></i><span id="toastText">å·²å®Œæˆ</span></div>

  <script>
    // =========================
    // Data Model
    // =========================
    // ä½ å¯ä»¥ä¾ç…§éœ€æ±‚æŒçºŒæ“´å……ï¼š
    // - day.theme: ç”¨æ–¼ç¯©é¸
    // - day.area/transit/note: ç”¨æ–¼è©³ç´°è¦–çª—
    // - activities[].id: ç”¨æ–¼æ”¶è—/å®šä½/åŒ¯å‡º

    
    const TRIP = {
      title: 'æ›¼è°·è¦ªå­å…­å¤©äº”å¤œ',
      days: [
        {
          id: 'd1',
          day: 1,
          date: '2026/02/04 (ä¸‰)',
          title: 'å‡ºç™¼æ—¥ï¼šCI831 å‰å¾€æ›¼è°· + é£¯åº—å…¥ä½ + ICONSIAM å¤œæ™¯',
          theme: ['é£›è¡Œ', 'æŠµé”', 'è³¼ç‰©', 'å¤œæ™¯', 'è¦ªå­'],
          area: 'Suvarnabhumi (BKK) â†’ Sukhumvitï¼ˆThong Lo / Ekkamaiï¼‰',
          transit: 'BKK æ©Ÿå ´å¿«ç·š ARL â†’ MRT â†’ BTSï¼›æˆ–è¨ˆç¨‹è»Šï¼ˆä¾å­©å­ç‹€æ³å½ˆæ€§ï¼‰',
          note: 'èˆªç­æ™‚é–“ä»¥é•·æœŸç­è¡¨ç‚ºåŸºæº–ï¼Œå¯¦éš›ä»¥è¯èˆª/æ©Ÿå ´ç•¶æ—¥å…¬å‘Šç‚ºæº–ã€‚å…¥ä½ï¼šJasmine 59ï¼ˆThong Lo ç«™æ­¥è¡Œç´„ 8 åˆ†é˜ï¼‰ã€‚',
          photos: [
            { src: 'https://images.unsplash.com/photo-1598971861713-54ad16a7e72e?auto=format&fit=crop&w=1200&q=80', cap: 'Suvarnabhumi Airport' },
            { src: 'https://images.unsplash.com/photo-1562602833-0f4ab2fc46e4?auto=format&fit=crop&w=1200&q=80', cap: 'Airport Rail Link' },
            { src: 'https://images.unsplash.com/photo-1600166898405-da9535204843?auto=format&fit=crop&w=1200&q=80', cap: 'ICONSIAM æ²³ç•”å¤œæ™¯' }
          ],
          activities: [
            { id:'d1-a1', icon:'fa-plane-departure', text:'CI831 TPEâ†’BKKï¼ˆTPE T1 å‡ºç™¼ï¼›é è¨ˆ 10:05-13:05ï¼‰', time:'10:05', tags:['é£›è¡Œ','æŠµé”'] },
            { id:'d1-a2', icon:'fa-plane-arrival', text:'æŠµé” BKKï¼ˆé€šé—œ/é ˜è¡Œæï¼‰', time:'13:05', tags:['æŠµé”'] },
            { id:'d1-a3', icon:'fa-train-subway', text:'å¤§çœ¾é‹è¼¸åˆ° Jasmine 59ï¼šARLâ†’Makkasan / MRT Phetchaburiâ†’Sukhumvitâ†’BTS Thong Loâ†’æ­¥è¡Œ', time:'14:30', tags:['äº¤é€š','è¦ªå­'] },
            { id:'d1-a4', icon:'fa-hotel', text:'Jasmine 59 å…¥ä½ & ä¼‘æ¯ï¼ˆæ³³æ± /å°é»å¿ƒï¼‰', time:'16:30', tags:['è¦ªå­'] },
            { id:'d1-a5', icon:'fa-bag-shopping', text:'æ™šé¤ï¼šICONSIAMï¼ˆSOOKSIAM ç¾é£Ÿ/å®¤å…§è¦ªå­å‹å–„ï¼‰', time:'18:30', tags:['è³¼ç‰©','å¤œæ™¯','è¦ªå­'] },
          ]
        },
        {
          id: 'd2',
          day: 2,
          date: '2026/02/05 (å››)',
          title: 'å¤§åŸä¸€æ—¥ï¼šç…å­å‹•ç‰©åœ’ + å¤éƒ½æ™¯é»ï¼ˆå»ºè­°åŒ…è»Š/ä¸€æ—¥åœ˜ï¼‰',
          theme: ['å‹•ç‰©åœ’', 'è¦ªå­', 'æ–‡åŒ–', 'éƒŠå€'],
          area: 'Ayutthayaï¼ˆå¤§åŸï¼‰',
          transit: 'åŒ…è»Š/ä¸€æ—¥åœ˜ï¼ˆå¾å¸‚å€å–®ç¨‹ç´„ 1.5â€“2 å°æ™‚ï¼Œè¦ªå­æœ€çœåŠ›ï¼‰',
          note: 'è‹¥å­©å­æ€•ç†±ï¼Œæ™¯é»ä¹‹é–“å¯ç”¨è»Šä¸Šè£œçœ /åƒé»å¿ƒã€‚å¤§åŸå¯ºå»Ÿåƒè§€è«‹æº–å‚™é®é™½ã€é˜²èšŠã€è–„å¤–å¥—ï¼ˆå†·æ°£è»Šï¼‰ã€‚',
          photos: [
            { src: 'https://images.unsplash.com/photo-1548036328-c9fa89d128fa?auto=format&fit=crop&w=1200&q=80', cap: 'Ayutthaya å¤åŸ' },
            { src: 'https://images.unsplash.com/photo-1542640244-7e672d6cef4e?auto=format&fit=crop&w=1200&q=80', cap: 'è¦ªå­å‹•ç‰©äº’å‹•' },
            { src: 'https://images.unsplash.com/photo-1546015720-b8b30df5aa27?auto=format&fit=crop&w=1200&q=80', cap: 'æ²³ç•”å¤•é™½' }
          ],
          activities: [
            { id:'d2-a1', icon:'fa-mug-hot', text:'é£¯åº—æ—©é¤ï¼ˆå‡ºç™¼å‰è£œæ°´ã€é˜²æ›¬ï¼‰', time:'08:00', tags:['è¦ªå­'] },
            { id:'d2-a2', icon:'fa-van-shuttle', text:'å‡ºç™¼å‰å¾€å¤§åŸï¼ˆè»Šç¨‹ç´„ 1.5â€“2 å°æ™‚ï¼‰', time:'09:00', tags:['äº¤é€š'] },
            { id:'d2-a3', icon:'fa-paw', text:'å¤§åŸç…å­å‹•ç‰©åœ’ï¼ˆè¦ªå­æ‹ç…§/å‹•ç‰©äº’å‹•ï¼‰', time:'11:00', tags:['å‹•ç‰©åœ’','è¦ªå­'] },
            { id:'d2-a4', icon:'fa-landmark', text:'å‘¨é‚Šæ¨è–¦ï¼šWat Mahathatï¼ˆæ¨¹æ ¹ä½›é ­ï¼‰/ Wat Chaiwatthanaramï¼ˆç¶“å…¸æ²³ç•”å¯ºå»Ÿï¼‰', time:'14:00', tags:['æ–‡åŒ–','è¦ªå­'] },
            { id:'d2-a5', icon:'fa-ship', text:'(å¯é¸) å¤§åŸæ²³ç•”çŸ­ç¨‹èˆ¹/å‚æ™šå›ç¨‹', time:'16:30', tags:['è¦ªå­','æ–‡åŒ–'] },
            { id:'d2-a6', icon:'fa-bowl-food', text:'å›æ›¼è°·æ™šé¤ï¼ˆThong Lo/Ekkamai å‘¨é‚Šï¼‰', time:'19:30', tags:['ç¾é£Ÿ','è¦ªå­'] },
          ]
        },
        {
          id: 'd3',
          day: 3,
          date: '2026/02/06 (äº”)',
          title: 'Siam Amazing Park æ°´é™¸æ¨‚åœ’æ”¾é›»æ—¥',
          theme: ['éŠæ¨‚åœ’', 'è¦ªå­', 'æ°´ä¸Šæ´»å‹•'],
          area: 'Siam Amazing Parkï¼ˆBangkok æ±åŒ—å´ï¼‰',
          transit: 'å»ºè­°è¨ˆç¨‹è»Š/åŒ…è»Šï¼ˆå–®ç¨‹ç´„ 45â€“60 åˆ†ï¼‰ï¼›å¤§çœ¾é‹è¼¸å¯è½‰ä¹˜å…¬è»Š/è¨ˆç¨‹è»Šï¼ˆæ™‚é–“è¼ƒé•·ï¼‰',
          note: 'å¸¶æ³³è¡£/é˜²æ›¬/æ‹–é‹ï¼›å¯æº–å‚™é˜²æ°´è¢‹èˆ‡æ›¿æ›è¡£ç‰©ã€‚è‹¥å­©å­å¹´ç´€å°ï¼Œå¯å…ˆé–å®šæ°´ä¸Šå€èˆ‡è¼•åº¦è¨­æ–½ã€‚',
          photos: [
            { src: 'https://images.unsplash.com/photo-1500375592092-40eb2168fd21?auto=format&fit=crop&w=1200&q=80', cap: 'æ°´ä¸Šæ¨‚åœ’' },
            { src: 'https://images.unsplash.com/photo-1542038784456-1ea8e935640e?auto=format&fit=crop&w=1200&q=80', cap: 'è¦ªå­ç©æ°´' },
            { src: 'https://images.unsplash.com/photo-1529692236671-f1f6cf9683ba?auto=format&fit=crop&w=1200&q=80', cap: 'éŠæ¨‚è¨­æ–½' }
          ],
          activities: [
            { id:'d3-a1', icon:'fa-bowl-food', text:'æ—©é¤ & æ•´è£ï¼ˆæ³³å…·ã€é˜²æ›¬ã€æ¯›å·¾ï¼‰', time:'08:00', tags:['è¦ªå­'] },
            { id:'d3-a2', icon:'fa-taxi', text:'å‰å¾€ Siam Amazing Parkï¼ˆäº¤é€šæŠ“ 1 å°æ™‚è¼ƒä¿éšªï¼‰', time:'09:00', tags:['äº¤é€š'] },
            { id:'d3-a3', icon:'fa-water', text:'æ°´ä¸Šå€ï¼šæ¼‚æ¼‚æ²³ / å…’ç«¥æˆ²æ°´æ± ', time:'10:30', tags:['æ°´ä¸Šæ´»å‹•','è¦ªå­'] },
            { id:'d3-a4', icon:'fa-person-running', text:'é™¸ä¸Šå€ï¼šè¼•åº¦è¨­æ–½/è¦ªå­é©åˆå€', time:'14:00', tags:['éŠæ¨‚åœ’','è¦ªå­'] },
            { id:'d3-a5', icon:'fa-ice-cream', text:'å›é£¯åº—ä¼‘æ¯ï¼ˆè£œæ°´ã€ç°¡å–®æ™šé¤/å¤–å¸¶ï¼‰', time:'18:30', tags:['è¦ªå­'] },
          ]
        },
        {
          id: 'd4',
          day: 4,
          date: '2026/02/07 (å…­)',
          title: 'æ›é£¯åº—æ—¥ï¼šJasmine 59 â†’ Cape House + Siam è¦ªå­ä¸‹åˆ',
          theme: ['æ›é£¯åº—', 'å¸‚å€', 'è¦ªå­', 'å®¤å…§'],
          area: 'Thong Lo â†’ Chit Lom / Langsuan',
          transit: 'BTSï¼šThong Lo â†’ Chit Lomï¼ˆæ­¥è¡Œ/çŸ­ç¨‹è¨ˆç¨‹è»Šåˆ° Cape Houseï¼‰',
          note: 'é€€æˆ¿å‰å¯å…ˆè«‹é£¯åº—å”åŠ©å¯„æ”¾è¡Œæï¼›ä¸‹åˆå®‰æ’å®¤å…§è¦ªå­æ™¯é»ï¼Œé¿é–‹æœ€ç†±æ™‚æ®µã€‚',
          photos: [
            { src: 'https://images.unsplash.com/photo-1542556398-95fb5b9f163f?auto=format&fit=crop&w=1200&q=80', cap: 'BTS Skytrain' },
            { src: 'https://images.unsplash.com/photo-1526481280695-3c687fd5432c?auto=format&fit=crop&w=1200&q=80', cap: 'Siam å•†åœˆ' },
            { src: 'https://images.unsplash.com/photo-1527600478564-488952effedc?auto=format&fit=crop&w=1200&q=80', cap: 'è¦ªå­å®¤å…§æ™¯é»' }
          ],
          activities: [
            { id:'d4-a1', icon:'fa-bowl-food', text:'æ—©é¤å¾Œæ•´ç†è¡Œæ/é€€æˆ¿ï¼ˆå¯å…ˆå¯„æ”¾ï¼‰', time:'09:00', tags:['æ›é£¯åº—'] },
            { id:'d4-a2', icon:'fa-train-subway', text:'BTS å‰å¾€ Chit Lomï¼ˆç´„ 20â€“30 åˆ† + æ­¥è¡Œï¼‰', time:'10:30', tags:['äº¤é€š','æ›é£¯åº—'] },
            { id:'d4-a3', icon:'fa-hotel', text:'Cape House å…¥ä½ï¼ˆLangsuanï¼‰', time:'12:00', tags:['æ›é£¯åº—'] },
            { id:'d4-a4', icon:'fa-fish-fins', text:'ä¸‹åˆæ¨è–¦ï¼šSEA LIFE Bangkok Ocean Worldï¼ˆæˆ– Siam Paragon å…§è¦ªå­è¨­æ–½ï¼‰', time:'14:30', tags:['è¦ªå­','å®¤å…§'] },
            { id:'d4-a5', icon:'fa-tree', text:'å‚æ™šï¼šLumphini Park æ”¾é¢¨/çœ‹èœ¥èœ´ï¼ˆè¦–é«”åŠ›ï¼‰', time:'17:30', tags:['è¦ªå­','å¸‚å€'] },
            { id:'d4-a6', icon:'fa-bowl-rice', text:'æ™šé¤ï¼šLangsuan / Central Embassy å‘¨é‚Š', time:'19:00', tags:['ç¾é£Ÿ','è¦ªå­'] },
          ]
        },
        {
          id: 'd5',
          day: 5,
          date: '2026/02/08 (æ—¥)',
          title: 'éƒŠå€æ–‡åŒ–æ—¥ï¼šå¤åŸï¼ˆAncient Cityï¼‰/ ä¸‰é ­è±¡ç¥åšç‰©é¤¨ + å·§å…‹åŠ›æ‘æ™šé¤',
          theme: ['æ–‡åŒ–', 'è¦ªå­', 'éƒŠå€', 'æ‹ç…§'],
          area: 'Samut Prakanï¼ˆæ›¼è°·å—å´ï¼‰',
          transit: 'å»ºè­°åŒ…è»Š/è¨ˆç¨‹è»Šï¼ˆå–®ç¨‹ç´„ 45â€“70 åˆ†ï¼‰ï¼›è‹¥èµ°å¤§çœ¾äº¤é€šå¯ BTS åˆ° Kheha å†è½‰è»Š',
          note: 'å¤åŸåœ’å€å¾ˆå¤§ï¼Œå»ºè­°ç§Ÿé«˜çˆ¾å¤«è»Š/è…³è¸è»Šç¯€çœé«”åŠ›ï¼›å‚æ™šå†å» Chocolate Ville æ›´é©åˆæ‹ç…§èˆ‡ç”¨é¤ã€‚',
          photos: [
            { src: 'https://images.unsplash.com/photo-1552465011-b4e21bf6e79f?auto=format&fit=crop&w=1200&q=80', cap: 'Ancient Cityï¼ˆå¤åŸï¼‰' },
            { src: 'https://images.unsplash.com/photo-1548588684-4d3e4b0a3b0e?auto=format&fit=crop&w=1200&q=80', cap: 'Erawan Museum' },
            { src: 'https://images.unsplash.com/photo-1543340713-8d6b2b2e77f2?auto=format&fit=crop&w=1200&q=80', cap: 'Chocolate Ville' }
          ],
          activities: [
            { id:'d5-a1', icon:'fa-bowl-food', text:'æ—©é¤ & å‡ºç™¼ï¼ˆäº¤é€šæŠ“ 1 å°æ™‚è¼ƒä¿éšªï¼‰', time:'08:30', tags:['è¦ªå­'] },
            { id:'d5-a2', icon:'fa-camera', text:'å¤åŸï¼ˆAncient City / Muang Boranï¼‰åƒè§€ + ç§Ÿè»Šä»£æ­¥', time:'10:00', tags:['æ–‡åŒ–','è¦ªå­','æ‹ç…§'] },
            { id:'d5-a3', icon:'fa-landmark-dome', text:'åŠ ç¢¼ï¼šä¸‰é ­è±¡ç¥åšç‰©é¤¨ï¼ˆErawan Museumï¼‰', time:'14:30', tags:['æ–‡åŒ–','æ‹ç…§'] },
            { id:'d5-a4', icon:'fa-mug-saucer', text:'å›å¸‚å€å°ä¼‘æ¯/æ•´ç†ï¼ˆé¿å…ä¸€è·¯ç´¯åˆ°æ™šä¸Šï¼‰', time:'17:00', tags:['è¦ªå­'] },
            { id:'d5-a5', icon:'fa-cookie-bite', text:'å·§å…‹åŠ›æ‘ Chocolate Villeï¼šæ™šé¤ + ç«¥è©±é¢¨æ‹ç…§', time:'18:30', tags:['ç¾é£Ÿ','è¦ªå­','æ‹ç…§'] },
          ]
        },
        {
          id: 'd6',
          day: 6,
          date: '2026/02/09 (ä¸€)',
          title: 'å›åœ‹æ—¥ï¼šCI832 è¿”å›å°ç£',
          theme: ['è¿”ç¨‹', 'é£›è¡Œ', 'äº¤é€š'],
          area: 'Cape House â†’ BKK â†’ TPE',
          transit: 'å»ºè­°ï¼šBTS Chit Lom â†’ Siam â†’ Phaya Thai â†’ ARL é€²æ©Ÿå ´ï¼ˆç´„ 50â€“60 åˆ†ï¼‰',
          note: 'å›ç¨‹å»ºè­°ææ—©å‡ºç™¼ï¼šè¦ªå­ + è¡Œæå¤šï¼ŒæŠ“ã€Œèµ·é£›å‰ 3â€“3.5 å°æ™‚ã€é›¢é–‹é£¯åº—æ›´ä¿éšªã€‚',
          photos: [
            { src: 'https://images.unsplash.com/photo-1469474968028-56623f02e42e?auto=format&fit=crop&w=1200&q=80', cap: 'å›ç¨‹æ—¥' },
            { src: 'https://images.unsplash.com/photo-1529070538774-1843cb3265df?auto=format&fit=crop&w=1200&q=80', cap: 'æ©Ÿå ´å€™æ©Ÿ' },
            { src: 'https://images.unsplash.com/photo-1529070538774-1843cb3265df?auto=format&fit=crop&w=1200&q=80', cap: 'é£›è¡Œå›å®¶' }
          ],
          activities: [
            { id:'d6-a1', icon:'fa-suitcase-rolling', text:'æ•´ç†è¡Œæ / é€€æˆ¿ï¼ˆå¯è«‹é£¯åº—å”åŠ©å«è»Šï¼‰', time:'10:30', tags:['è¿”ç¨‹'] },
            { id:'d6-a2', icon:'fa-train-subway', text:'å¤§çœ¾é‹è¼¸å‰å¾€ BKKï¼šBTSâ†’Phaya Thaiâ†’ARLï¼ˆç´„ 54 åˆ†ï¼‰', time:'11:15', tags:['äº¤é€š','è¿”ç¨‹'] },
            { id:'d6-a3', icon:'fa-plane-departure', text:'CI832 BKKâ†’TPEï¼ˆé è¨ˆ 14:05-18:40ï¼›æŠµé” TPE T1ï¼‰', time:'14:05', tags:['é£›è¡Œ','è¿”ç¨‹'] },
          ]
        }
      ]
    };


    // è‹¥æƒ³ä»¥ã€Œæ›¼è°·æ™‚é–“ã€åˆ¤æ–·ä¸‹ä¸€å€‹è¡Œç¨‹ï¼Œæ”¹æˆ 420ï¼ˆUTC+7ï¼‰
    const TIMEZONE_OFFSET_MIN = null; // null = ä½¿ç”¨ç€è¦½å™¨æ™‚å€ï¼›420 = æ›¼è°·


    // =========================
    // Utilities
    // =========================
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    function pad2(n){ return String(n).padStart(2,'0'); }

    function showToast(msg){
      const toast = $('#toast');
      $('#toastText').textContent = msg;
      toast.classList.add('show');
      window.clearTimeout(showToast._t);
      showToast._t = window.setTimeout(()=>toast.classList.remove('show'), 1800);
    }

    function safeJsonParse(s, fallback){
      try{ return JSON.parse(s); }catch(_){ return fallback; }
    }

    function downloadText(filename, text){
      const blob = new Blob([text], {type:'text/plain;charset=utf-8'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    // Convert "2024/03/15 (äº”)" + "14:00" to Date
    // æ³¨æ„ï¼šé€™è£¡ä½¿ç”¨ç€è¦½å™¨æ™‚å€ï¼›è‹¥ TIMEZONE_OFFSET_MIN è¨­å®šç‚º 420ï¼Œæœƒä»¥å›ºå®š offset è¨ˆç®—ã€‚
    function parseDateTime(dateStr, timeStr){
      // dateStr: YYYY/MM/DD (X)
      const m = dateStr.match(/(\d{4})\/(\d{2})\/(\d{2})/);
      if(!m) return null;
      const y = Number(m[1]), mo = Number(m[2]), d = Number(m[3]);
      const [hh, mm] = timeStr.split(':').map(Number);

      if(TIMEZONE_OFFSET_MIN === null){
        return new Date(y, mo-1, d, hh, mm, 0, 0);
      }

      // Fixed timezone offset approach:
      // Build a UTC timestamp = local(timezone) - offset
      const utcMs = Date.UTC(y, mo-1, d, hh, mm) - (TIMEZONE_OFFSET_MIN * 60 * 1000);
      return new Date(utcMs);
    }

    function nowInMode(){
      if(TIMEZONE_OFFSET_MIN === null) return new Date();
      // If using fixed offset, return a Date object representing "now" in that fixed timezone (by shifting).
      const now = new Date();
      const utc = now.getTime() + (now.getTimezoneOffset() * 60 * 1000);
      const tz = new Date(utc + TIMEZONE_OFFSET_MIN * 60 * 1000);
      return tz;
    }

    // =========================
    // State
    // =========================
    const STORAGE_KEY_FAV = 'bkk_trip_favs_v1';
    const STORAGE_KEY_FILTER = 'bkk_trip_filter_v1';

    const state = {
      filterTheme: 'all',
      search: '',
      onlyFav: false,
      compact: false,
      favDays: new Set(),
    };

    function loadState(){
      const fav = safeJsonParse(localStorage.getItem(STORAGE_KEY_FAV), []);
      state.favDays = new Set(Array.isArray(fav) ? fav : []);

      const f = safeJsonParse(localStorage.getItem(STORAGE_KEY_FILTER), null);
      if(f){
        state.filterTheme = f.filterTheme ?? 'all';
        state.search = f.search ?? '';
        state.onlyFav = !!f.onlyFav;
        state.compact = !!f.compact;
      }
    }

    function saveState(){
      localStorage.setItem(STORAGE_KEY_FAV, JSON.stringify([...state.favDays]));
      localStorage.setItem(STORAGE_KEY_FILTER, JSON.stringify({
        filterTheme: state.filterTheme,
        search: state.search,
        onlyFav: state.onlyFav,
        compact: state.compact,
      }));
    }

    // =========================
    // Derived
    // =========================
    function getAllThemes(){
      const set = new Set();
      TRIP.days.forEach(d => d.theme.forEach(t => set.add(t)));
      return ['all', ...Array.from(set)];
    }

    function totalActivities(){
      return TRIP.days.reduce((acc,d)=>acc + d.activities.length, 0);
    }

    function matchesSearch(day){
      const q = state.search.trim().toLowerCase();
      if(!q) return true;
      const hay = [day.title, day.date, day.area, day.transit, day.note, ...day.theme, ...day.activities.map(a=>a.text), ...day.activities.flatMap(a=>a.tags||[])].join(' ').toLowerCase();
      return hay.includes(q);
    }

    function matchesTheme(day){
      if(state.filterTheme === 'all') return true;
      return day.theme.includes(state.filterTheme) || day.activities.some(a => (a.tags||[]).includes(state.filterTheme));
    }

    function matchesFav(day){
      if(!state.onlyFav) return true;
      return state.favDays.has(day.id);
    }

    function filteredDays(){
      return TRIP.days.filter(d => matchesSearch(d) && matchesTheme(d) && matchesFav(d));
    }

    // =========================
    // Render: Chips
    // =========================
    function renderChips(){
      const themes = getAllThemes();
      const root = $('#chipRow');
      root.innerHTML = '';

      themes.forEach(t => {
        const el = document.createElement('div');
        el.className = 'chip' + (state.filterTheme === t ? ' active' : '');
        const icon = t === 'all' ? 'fa-layer-group'
          : (t === 'å¤œå¸‚' ? 'fa-moon'
          : (t === 'å¯ºå»Ÿ' ? 'fa-landmark'
          : (t === 'å‹•ç‰©åœ’' ? 'fa-otter'
          : (t === 'éŠæ¨‚åœ’' ? 'fa-person-skating'
          : (t === 'è¦ªå­' ? 'fa-children'
          : (t === 'è³¼ç‰©' ? 'fa-bag-shopping'
          : (t === 'æŒ‰æ‘©' ? 'fa-spa'
          : (t === 'æ²³ç•”' ? 'fa-water'
          : 'fa-tag'))))))));

        el.innerHTML = `<i class="fa-solid ${icon}"></i><span>${t === 'all' ? 'å…¨éƒ¨ä¸»é¡Œ' : t}</span>`;
        el.addEventListener('click', () => {
          state.filterTheme = t;
          saveState();
          rerender();
          showToast(t === 'all' ? 'å·²é¡¯ç¤ºå…¨éƒ¨ä¸»é¡Œ' : `å·²å¥—ç”¨ç¯©é¸ï¼š${t}`);
        });
        root.appendChild(el);
      });
    }

    // =========================
    // Render: Timeline
    // =========================
    function buildDayCard(day){
      const wrap = document.createElement('div');
      wrap.className = 'day-card';
      wrap.dataset.dayId = day.id;

      const isFav = state.favDays.has(day.id);
      const themeTags = day.theme.map(t => `<span class="tag"><i class="fa-solid fa-tag"></i>${t}</span>`).join('');

      const acts = (state.compact ? day.activities.slice(0,3) : day.activities)
        .map(a => `
          <li>
            <i class="fa-solid ${a.icon}"></i>
            <span>${a.text}</span>
            <span class="activity-time">${a.time}</span>
          </li>
        `).join('');

      const moreHint = state.compact && day.activities.length > 3
        ? `<div class="note" style="margin-top:12px;">å·²å•Ÿç”¨<b>ç²¾ç°¡æ¨¡å¼</b>ï¼Œå°šæœ‰ ${day.activities.length-3} å€‹è¡Œç¨‹é»æœªé¡¯ç¤ºï¼ˆé»å¡ç‰‡å¯çœ‹å…¨éƒ¨ï¼‰ã€‚</div>`
        : '';

      wrap.innerHTML = `
        <div class="card-content">
          <div class="day-header">
            <div class="day-number"><span>DAY</span><span>${day.day}</span></div>
            <div>
              <div class="day-title">${day.title} ${isFav ? ' <i class="fa-solid fa-heart" style="color:var(--gold);"></i>' : ''}</div>
              <div class="day-date">${day.date}</div>
              <div class="meta-row">${themeTags}</div>
            </div>
          </div>
          <ul class="activities">${acts}</ul>
          ${moreHint}
          <div class="mini-actions">
            <div class="mini-btn" data-action="open"><i class="fa-solid fa-circle-info"></i>è©³ç´°</div>
            <div class="mini-btn" data-action="fav"><i class="fa-solid ${isFav ? 'fa-heart' : 'fa-heart-circle-plus'}"></i>${isFav ? 'å–æ¶ˆæ”¶è—' : 'æ”¶è—'}</div>
            <div class="mini-btn" data-action="jump"><i class="fa-solid fa-location-dot"></i>å®šä½</div>
          </div>
        </div>
      `;

      // Card click: open modal
      wrap.querySelector('[data-action="open"]').addEventListener('click', (e)=>{ e.stopPropagation(); openModal(day.id); });
      wrap.addEventListener('click', ()=> openModal(day.id));

      // Fav
      wrap.querySelector('[data-action="fav"]').addEventListener('click', (e)=>{
        e.stopPropagation();
        toggleFav(day.id);
      });

      // Jump
      wrap.querySelector('[data-action="jump"]').addEventListener('click', (e)=>{
        e.stopPropagation();
        document.querySelector(`[data-day-id="${day.id}"]`)?.scrollIntoView({behavior:'smooth', block:'center'});
        showToast('å·²å®šä½åˆ°è©²å¤©');
      });

      return wrap;
    }

    function renderTimeline(){
      const root = $('#timelineRoot');
      root.innerHTML = '';

      const days = filteredDays();
      if(days.length === 0){
        const empty = document.createElement('div');
        empty.className = 'panel';
        empty.style.maxWidth = '760px';
        empty.style.margin = '0 auto';
        empty.innerHTML = `
          <h3><i class="fa-solid fa-circle-exclamation"></i>æ²’æœ‰ç¬¦åˆçš„è¡Œç¨‹</h3>
          <p style="opacity:.78; line-height:1.6; margin-top:8px;">
            è«‹å˜—è©¦èª¿æ•´ä¸»é¡Œç¯©é¸ã€æ¸…é™¤æœå°‹é—œéµå­—ï¼Œæˆ–é—œé–‰ã€Œåªçœ‹æ”¶è—ã€ã€‚
          </p>
          <div class="mini-actions" style="margin-top:14px;">
            <div class="mini-btn" id="emptyReset"><i class="fa-solid fa-rotate-left"></i>é‡è¨­</div>
          </div>
        `;
        root.appendChild(empty);
        $('#emptyReset')?.addEventListener('click', ()=>{
          state.filterTheme = 'all';
          state.search = '';
          state.onlyFav = false;
          state.compact = false;
          saveState();
          rerender();
          showToast('å·²é‡è¨­');
        });
        return;
      }

      days.forEach(d => root.appendChild(buildDayCard(d)));

      // re-bind observer
      setupObserver();
    }

    // =========================
    // Intersection Observer
    // =========================
    let observer = null;

    function setupObserver(){
      if(observer){
        try{ observer.disconnect(); }catch(_){ }
      }

      const observerOptions = { threshold: 0.2, rootMargin: '0px 0px -50px 0px' };
      observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) entry.target.classList.add('visible');
        });
      }, observerOptions);

      $$('.day-card').forEach(card => observer.observe(card));
    }

    // =========================
    // Modal
    // =========================
    function openModal(dayId){
      const day = TRIP.days.find(d=>d.id===dayId);
      if(!day) return;

      $('#modal').classList.add('open');
      document.body.style.overflow = 'hidden';

      const isFav = state.favDays.has(day.id);

      $('#modalTitle').textContent = day.title;
      $('#modalDate').textContent = day.date;
      $('#modalArea').textContent = day.area || 'â€”';
      $('#modalTransit').textContent = day.transit || 'â€”';
      $('#modalNote').textContent = day.note || 'â€”';

      $('#modalDayTag').innerHTML = `<i class="fa-solid fa-calendar"></i><span>DAY ${day.day}</span>`;
      $('#modalThemeTag').innerHTML = `<i class="fa-solid fa-tags"></i><span>${day.theme.join(' / ')}</span>`;
      $('#modalFavTag').style.display = isFav ? 'inline-flex' : 'none';

      const gallery = $('#modalGallery');
      const photos = Array.isArray(day.photos) ? day.photos.slice(0,3) : [];
      gallery.innerHTML = photos.length ? photos.map(p => `
        <div class="photo">
          <img src="${p.src}" alt="${(p.cap||'')}" loading="lazy">
          <div class="cap">${p.cap||''}</div>
        </div>
      `).join('') : '<div class="note" style="margin:0;">æ­¤å¤©å°šæœªè¨­å®šä»£è¡¨ç…§ç‰‡ï¼ˆå¯åœ¨ TRIP.days[].photos è£œä¸Šï¼‰ã€‚</div>';

      const list = $('#modalList');
      list.innerHTML = '';
      day.activities.forEach(a => {
        const li = document.createElement('li');
        li.innerHTML = `<i class="fa-solid ${a.icon}" style="color:var(--gold);"></i><span class="t">${a.text}</span><span class="tm">${a.time}</span>`;
        list.appendChild(li);
      });

      const btnFav = $('#btnToggleFav');
      btnFav.innerHTML = `<i class="fa-solid fa-heart"></i>${isFav ? 'å–æ¶ˆæ”¶è—é€™ä¸€å¤©' : 'æ”¶è—é€™ä¸€å¤©'}`;
      btnFav.onclick = () => toggleFav(day.id, true);

      $('#btnCopy').onclick = () => {
        const summary = buildDaySummary(day);
        navigator.clipboard?.writeText(summary).then(()=>showToast('å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿')).catch(()=>showToast('è¤‡è£½å¤±æ•—ï¼ˆç€è¦½å™¨é™åˆ¶ï¼‰'));
      };

      $('#btnExport2').onclick = () => exportTrip();

      // focus close
      $('#modalClose').focus?.();
    }

    function closeModal(){
      $('#modal').classList.remove('open');
      document.body.style.overflow = '';
    }

    // =========================
    // Favorites
    // =========================
    function toggleFav(dayId, fromModal=false){
      if(state.favDays.has(dayId)){
        state.favDays.delete(dayId);
        showToast('å·²å–æ¶ˆæ”¶è—');
      } else {
        state.favDays.add(dayId);
        showToast('å·²åŠ å…¥æ”¶è—');
      }
      saveState();
      rerender(false);

      if(fromModal){
        // update modal badge/button
        const isFav = state.favDays.has(dayId);
        $('#modalFavTag').style.display = isFav ? 'inline-flex' : 'none';
        $('#btnToggleFav').innerHTML = `<i class="fa-solid fa-heart"></i>${isFav ? 'å–æ¶ˆæ”¶è—é€™ä¸€å¤©' : 'æ”¶è—é€™ä¸€å¤©'}`;
      }
    }

    // =========================
    // Export
    // =========================
    function buildDaySummary(day){
      const lines = [];
      lines.push(`DAY ${day.day}ï½œ${day.title}`);
      lines.push(`æ—¥æœŸï¼š${day.date}`);
      if(day.area) lines.push(`å€åŸŸï¼š${day.area}`);
      if(day.transit) lines.push(`äº¤é€šï¼š${day.transit}`);
      if(day.theme?.length) lines.push(`ä¸»é¡Œï¼š${day.theme.join(' / ')}`);
      if(day.note) lines.push(`å‚™è¨»ï¼š${day.note}`);
      lines.push('è¡Œç¨‹ï¼š');
      day.activities.forEach(a => lines.push(`- ${a.time}  ${a.text}`));
      return lines.join('\n');
    }

    function exportTrip(){
      const days = filteredDays();
      const favOnly = state.onlyFav;
      const title = `${TRIP.title}ï½œ${favOnly ? 'æ”¶è—' : 'è¡Œç¨‹'}åŒ¯å‡º`;

      const out = [];
      out.push(title);
      out.push('==============================');
      out.push(`åŒ¯å‡ºæ™‚é–“ï¼š${new Date().toLocaleString()}`);
      out.push(`ä¸»é¡Œç¯©é¸ï¼š${state.filterTheme === 'all' ? 'å…¨éƒ¨' : state.filterTheme}`);
      out.push(`æœå°‹ï¼š${state.search ? state.search : '(ç„¡)'}`);
      out.push(`åªçœ‹æ”¶è—ï¼š${state.onlyFav ? 'æ˜¯' : 'å¦'}`);
      out.push(`ç²¾ç°¡æ¨¡å¼ï¼š${state.compact ? 'æ˜¯' : 'å¦'}`);
      out.push('');

      days.forEach((d, idx) => {
        out.push(buildDaySummary(d));
        if(idx !== days.length-1) out.push('\n------------------------------\n');
      });

      const filename = `Bangkok_Trip_${favOnly ? 'Fav' : 'All'}_${pad2(new Date().getMonth()+1)}${pad2(new Date().getDate())}.txt`;
      downloadText(filename, out.join('\n'));
      showToast('å·²åŒ¯å‡º TXT');
    }

    // =========================
    // Jump to next upcoming activity
    // =========================
    function jumpToNext(){
      const now = nowInMode();
      const candidates = [];

      TRIP.days.forEach(day => {
        day.activities.forEach(a => {
          const dt = parseDateTime(day.date, a.time);
          if(dt) candidates.push({ day, a, dt });
        });
      });

      candidates.sort((x,y)=>x.dt - y.dt);
      const next = candidates.find(c => c.dt > now);

      if(!next){
        showToast('æ‰¾ä¸åˆ°ä¸‹ä¸€å€‹ï¼ˆå¯èƒ½å·²çµæŸæˆ–æ—¥æœŸä¸åœ¨æœªä¾†ï¼‰');
        document.querySelector('#timeline')?.scrollIntoView({behavior:'smooth'});
        return;
      }

      // ensure filters include the day
      state.onlyFav = false;
      state.filterTheme = 'all';
      state.search = '';
      saveState();
      rerender(false);

      // scroll to that day card
      requestAnimationFrame(()=>{
        const el = document.querySelector(`[data-day-id="${next.day.id}"]`);
        el?.scrollIntoView({behavior:'smooth', block:'center'});
        showToast(`ä¸‹ä¸€å€‹ï¼šDAY ${next.day.day} ${next.a.time} ${next.a.text}`);
      });
    }

    // =========================
    // Stats
    // =========================
    function renderStats(){
      const daysShown = filteredDays().length;
      const itemsShown = filteredDays().reduce((acc,d)=> acc + (state.compact ? Math.min(3, d.activities.length) : d.activities.length), 0);

      $('#statDays').textContent = String(daysShown);
      $('#statItems').textContent = String(itemsShown);
      $('#statFavs').textContent = String(state.favDays.size);

      $('#badgeDays').textContent = `${TRIP.days.length} å¤©`;
      $('#badgeItems').textContent = `${totalActivities()} å€‹è¡Œç¨‹é»`;
      $('#badgeFavs').textContent = `${state.favDays.size} å€‹æ”¶è—`;
    }

    // =========================
    // Rerender
    // =========================
    function rerender(scrollToTimeline=true){
      renderChips();
      renderTimeline();
      renderStats();

      // update buttons
      $('#btnFav').classList.toggle('active', state.onlyFav);
      $('#btnAll').classList.toggle('active', !state.onlyFav && state.filterTheme==='all' && !state.search);
      $('#toggleCompact').dataset.on = state.compact ? 'true' : 'false';
      $('#searchInput').value = state.search;

      if(scrollToTimeline){
        document.querySelector('#timeline')?.scrollIntoView({behavior:'smooth', block:'start'});
      }
    }

    // =========================
    // Event Wiring
    // =========================
    function wireEvents(){
      // Hero scroll
      $('#scrollToSummary').addEventListener('click', () => {
        document.querySelector('#controls').scrollIntoView({behavior:'smooth'});
      });

      // Smooth scroll top
      $('#btnScrollTop').addEventListener('click', ()=> document.querySelector('#top')?.scrollIntoView({behavior:'smooth'}));

      // Export
      $('#btnExport').addEventListener('click', exportTrip);

      // All
      $('#btnAll').addEventListener('click', ()=>{
        state.onlyFav = false;
        state.filterTheme = 'all';
        state.search = '';
        saveState();
        rerender();
        showToast('å·²é¡¯ç¤ºå…¨éƒ¨');
      });

      // Fav
      $('#btnFav').addEventListener('click', ()=>{
        state.onlyFav = !state.onlyFav;
        saveState();
        rerender();
        showToast(state.onlyFav ? 'å·²åˆ‡æ›ï¼šåªçœ‹æ”¶è—' : 'å·²åˆ‡æ›ï¼šé¡¯ç¤ºå…¨éƒ¨');
      });

      // Jump next
      $('#btnToday').addEventListener('click', jumpToNext);

      // Search
      $('#searchInput').addEventListener('input', (e)=>{
        state.search = e.target.value;
        saveState();
        rerender(false);
      });

      // Compact toggle
      $('#toggleCompact').addEventListener('click', ()=>{
        state.compact = !state.compact;
        saveState();
        rerender(false);
        showToast(state.compact ? 'å·²å•Ÿç”¨ç²¾ç°¡æ¨¡å¼' : 'å·²é—œé–‰ç²¾ç°¡æ¨¡å¼');
      });

      // Clear filters
      $('#btnClearFilters').addEventListener('click', ()=>{
        state.filterTheme = 'all';
        state.search = '';
        state.onlyFav = false;
        state.compact = false;
        saveState();
        rerender(false);
        showToast('å·²æ¸…é™¤ç¯©é¸');
      });

      // Clear favs
      $('#btnClearFavs').addEventListener('click', ()=>{
        state.favDays.clear();
        saveState();
        rerender(false);
        showToast('å·²æ¸…ç©ºæ”¶è—');
      });

      // Modal close
      $('#modalClose').addEventListener('click', closeModal);
      $('#modal').addEventListener('click', (e)=>{
        if(e.target.id === 'modal') closeModal();
      });

      window.addEventListener('keydown', (e)=>{
        const key = e.key.toLowerCase();
        if(key === 'escape') closeModal();
        if(key === 'a') $('#btnAll').click();
        if(key === 'f') $('#btnFav').click();
        if(key === 'e') $('#btnExport').click();
        if(key === 't') $('#btnToday').click();
      });

      // Parallax on hero
      window.addEventListener('scroll', () => {
        const scrolled = window.pageYOffset;
        const hero = document.querySelector('.hero');
        hero.style.backgroundPositionY = scrolled * 0.45 + 'px';
      });
    }

    // =========================
    // Init
    // =========================
    function init(){
      loadState();
      wireEvents();
      rerender(false);

      // default focus values
      $('#searchInput').value = state.search;
      $('#toggleCompact').dataset.on = state.compact ? 'true' : 'false';

      // scroll to timeline on initial load only if there's a saved filter
      const hasSaved = !!localStorage.getItem(STORAGE_KEY_FILTER);
      if(hasSaved) {
        // no auto-scroll; keep user at top
      }
    }

    init();
  </script>
</body>
</html>
